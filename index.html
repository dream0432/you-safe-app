<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>You Safe - ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå)</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Kanit', sans-serif; background-color: #f0f2f5; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; overflow-x: hidden; position: relative; }
        
        /* Layout */
        .selection-screen { display: flex; gap: 30px; text-align: center; width: 100%; max-width: 900px; justify-content: center; }
        .form-screen, .admin-screen { display: none; width: 100%; max-width: 600px; animation: fadeIn 0.5s ease; }
        
        /* Card Styles */
        .role-card { width: 100%; max-width: 400px; background: white; padding: 50px 30px; border-radius: 20px; cursor: pointer; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 2px solid transparent; transition: all 0.3s ease; }
        .role-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: #FF8C42; }
        .role-icon { font-size: 4rem; margin-bottom: 20px; display: block; }
        .role-card h2 { color: #FF8C42; font-size: 1.8rem; margin-bottom: 10px; }
        .role-card p { color: #777; }

        /* Form Styles */
        .form-box { background: white; padding: 40px; border-radius: 20px; border-top: 8px solid #FF8C42; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .form-header h2 { margin-bottom: 5px; color: #333; }
        .form-header p { color: #888; margin-bottom: 20px; font-size: 0.9rem; }
        
        /* Input & Textarea */
        .input-field {
            width: 100%; padding: 15px;
            border: 2px solid #eee; border-radius: 12px;
            font-family: 'Kanit', sans-serif; font-size: 1rem;
            margin-bottom: 15px;
        }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ (Read Only) */
        .input-field[readonly] { background-color: #f0f0f0; color: #888; cursor: not-allowed; }

        textarea.input-field { height: 200px; resize: none; margin-bottom: 20px; }
        .input-field:focus { outline: none; background-color: #fafafa; border-color: #FF8C42; }
        
        /* Buttons */
        .action-btn { width: 100%; padding: 15px; border: none; border-radius: 10px; color: white; font-size: 1.1rem; cursor: pointer; background-color: #FF8C42; font-weight: 600; }
        .action-btn:hover { opacity: 0.9; }
        .back-btn { display: inline-block; margin-bottom: 15px; color: #666; cursor: pointer; font-size: 0.9rem; }
        .back-btn:hover { text-decoration: underline; }

        /* Admin Styles */
        .admin-box { background: white; padding: 30px; border-radius: 20px; border-top: 8px solid #333; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .message-item { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: flex-start; }
        .msg-content { flex: 1; margin-right: 15px; }
        .msg-name { font-weight: 600; color: #FF8C42; margin-bottom: 3px; font-size: 1.05rem; }
        .msg-text { font-size: 1rem; color: #333; margin-bottom: 5px; white-space: pre-wrap; }
        .msg-date { font-size: 0.8rem; color: #999; }
        
        .btn-group { display: flex; gap: 5px; flex-direction: column; }
        .delete-btn { background: #ff4d4d; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
        .delete-btn:hover { background: #d93636; }
        .edit-btn { background: #ffaa00; color: white; border: none; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 0.8rem; }
        .edit-btn:hover { background: #e69900; }

        .admin-toggle { position: fixed; bottom: 10px; right: 10px; background: transparent; border: none; color: #ccc; cursor: pointer; font-size: 0.8rem; }
        .admin-toggle:hover { color: #333; }

        /* Modal Styles */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 1000;
            justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.5s ease;
        }
        .modal-overlay.show { display: flex; opacity: 1; }
        .modal-box {
            background: white; padding: 40px 30px; border-radius: 25px;
            text-align: center; max-width: 90%; width: 400px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transform: scale(0.9); transition: transform 0.5s ease;
        }
        .modal-overlay.show .modal-box { transform: scale(1); }
        .modal-text { font-size: 1.6rem; font-weight: 600; color: #4A4A4A; line-height: 1.5; margin-bottom: 20px; }
        .modal-btn-confirm { background: #333; color: white; padding: 10px 30px; border: none; border-radius: 50px; cursor: pointer; font-size: 1rem; }
        .modal-btn-cancel { background: #eee; color: #333; padding: 10px 30px; border: none; border-radius: 50px; cursor: pointer; font-size: 1rem; margin-right: 10px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div class="modal-overlay" id="successModal">
        <div class="modal-box">
            <p class="modal-text" id="encouragementText">...</p>
        </div>
    </div>

    <div class="modal-overlay" id="loginModal">
        <div class="modal-box">
            <h3 style="margin-bottom:15px;">üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</h3>
            <input type="password" id="adminPassword" class="input-field" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô..." style="text-align:center;">
            <div style="margin-top:20px;">
                <button class="modal-btn-cancel" onclick="closeLogin()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="modal-btn-confirm" onclick="checkLogin()">‡∏ï‡∏Å‡∏•‡∏á</button>
            </div>
        </div>
    </div>

    <div class="selection-screen" id="selectionScreen">
        <div class="role-card" id="btnVenter">
            <span class="role-icon">üòä</span>
            <h2>‡∏ú‡∏π‡πâ‡∏£‡∏∞‡∏ö‡∏≤‡∏¢</h2>
            <p>‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏ö‡∏≤‡∏¢‡πÉ‡∏à ‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏Ñ‡∏£‡∏™‡∏±‡∏Å‡∏Ñ‡∏ô‡∏ü‡∏±‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏ü‡∏±‡∏á‡πÑ‡∏î‡πâ‡∏ô‡∏∞</p>
        </div>
    </div>

    <div class="form-screen" id="formScreen">
        <a class="back-btn" id="btnBackForm">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <div class="form-box">
            <div class="form-header">
                <h2>üòä ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏à</h2>
                <p>‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
            </div>
            
            <input type="text" id="formName" class="input-field" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)">
            <textarea id="formInput" class="input-field" placeholder="‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏à‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏°‡∏≤‡∏ö‡πâ‡∏≤‡∏á? ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?..."></textarea>
            
            <button class="action-btn" id="btnSend">‡∏™‡πà‡∏á‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß</button>
        </div>
    </div>

    <div class="admin-screen" id="adminScreen">
        <a class="back-btn" id="btnBackAdmin">‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <div class="admin-box">
            <h2>üîí Admin Dashboard</h2>
            <p>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
            <ul style="list-style:none; margin-top:20px;" id="messageList">
                <p style="text-align:center; color:#ccc;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
            </ul>
        </div>
    </div>

    <button class="admin-toggle" id="btnAdminLogin">Admin Login</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Config ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
        const firebaseConfig = {
            apiKey: "AIzaSyDemVd2LZXn-wTWon-KOxIdN3AxkzASnkY",
            authDomain: "you-safe-6a7bd.firebaseapp.com",
            databaseURL: "https://you-safe-6a7bd-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "you-safe-6a7bd",
            storageBucket: "you-safe-6a7bd.firebasestorage.app",
            messagingSenderId: "770251925608",
            appId: "1:770251925608:web:b64c667a14837ad05df3dd",
            measurementId: "G-JPRR8JM77J"
        };

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô Firebase (‡πÉ‡∏™‡πà try-catch ‡∏Å‡∏±‡∏ô‡∏û‡∏±‡∏á)
        try {
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            var messagesRef = ref(db, 'messages'); // ‡πÉ‡∏ä‡πâ var ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πà‡∏ß
        } catch (e) {
            console.error("Firebase Error:", e);
            alert("‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï");
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏Ñ‡∏°‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥ (Safety Guard Added) ---
        const allQuotes = [
            "‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡πâ‡∏≤‡∏á‡πÜ ‡∏ï‡∏±‡∏ß‡∏Ñ‡∏∏‡∏ì<br>‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏•‡πâ‡∏°‡∏•‡∏á‡πÄ‡∏™‡∏°‡∏≠ üòä",
            "‡πÄ‡∏Å‡πà‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏•‡∏¢‡∏ô‡∏∞<br>‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏ß‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÑ‡∏î‡πâ ‚úåÔ∏è",
            "‡∏£‡πâ‡∏≠‡∏á‡πÑ‡∏´‡πâ‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÑ‡∏î‡πâ‡∏ô‡∏∞<br>‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ üåßÔ∏è",
            "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡∏ô‡∏∞<br>‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏à‡∏£‡πâ‡∏≤‡∏¢‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏•‡∏¢ üíñ",
            "‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ...<br>‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ô‡∏∞ üå§Ô∏è",
            "‡∏Å‡∏≠‡∏î‡πÜ ‡∏ô‡∏∞<br>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏±‡∏ß‡∏Ñ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ô‡∏∞ ü§ó",
            "‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏à‡πá‡∏ö‡∏õ‡∏ß‡∏î<br>‡∏à‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏™‡∏°‡∏≠ üå±",
            "‡∏¢‡∏¥‡πâ‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ö‡πâ‡∏≤‡∏á‡∏ô‡∏∞<br>‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏≥‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß üòä",
            "‡∏ü‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ù‡∏ô<br>‡∏¢‡πà‡∏≠‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏™‡∏°‡∏≠ üåà",
            "‡πÄ‡∏´‡∏ô‡∏∑‡πà‡∏≠‡∏¢‡∏Å‡πá‡∏û‡∏±‡∏Å‡∏ô‡∏∞<br>‡πÄ‡∏£‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏°‡∏≠ üîã"
        ];

        function getRandomQuote() {
            let availableQuotes = [];
            
            // Safety Guard: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î
            try {
                const stored = localStorage.getItem('availableQuotes');
                if (stored) {
                    availableQuotes = JSON.parse(stored);
                }
            } catch (error) {
                console.log("Resetting quotes due to error");
                availableQuotes = []; // ‡∏ñ‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏µ‡∏¢ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
            }

            // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Array ‡∏´‡∏£‡∏∑‡∏≠ Array ‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏´‡∏°‡πà
            if (!Array.isArray(availableQuotes) || availableQuotes.length === 0) {
                availableQuotes = [...allQuotes];
            }

            const randomIndex = Math.floor(Math.random() * availableQuotes.length);
            const selectedQuote = availableQuotes[randomIndex];

            availableQuotes.splice(randomIndex, 1);
            localStorage.setItem('availableQuotes', JSON.stringify(availableQuotes));

            return selectedQuote;
        }

        // Element Refs
        const selectionScreen = document.getElementById('selectionScreen');
        const formScreen = document.getElementById('formScreen');
        const adminScreen = document.getElementById('adminScreen');
        const formInput = document.getElementById('formInput');
        const formName = document.getElementById('formName');
        const messageList = document.getElementById('messageList');
        const successModal = document.getElementById('successModal');
        const loginModal = document.getElementById('loginModal');
        const adminPassword = document.getElementById('adminPassword');
        const encouragementText = document.getElementById('encouragementText');

        // Modal Logic
        function closeSuccessModal() {
            successModal.classList.remove('show');
            setTimeout(() => {
                successModal.style.display = 'none';
                formInput.value = '';
                formName.value = '';
                document.getElementById('btnBackForm').click();
            }, 500);
        }

        // ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å HTML ‡πÑ‡∏î‡πâ (Global Scope)
        window.closeLogin = () => {
            loginModal.classList.remove('show');
            setTimeout(() => loginModal.style.display = 'none', 500);
        };

        window.checkLogin = () => {
            if(adminPassword.value === "23072549") {
                window.closeLogin();
                selectionScreen.classList.add('hidden');
                adminScreen.style.display = 'block';
            } else {
                alert("‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î!");
            }
        };

        // Event Listeners
        document.getElementById('btnAdminLogin').onclick = () => {
            loginModal.style.display = 'flex';
            setTimeout(() => loginModal.classList.add('show'), 10);
            adminPassword.value = '';
            adminPassword.focus();
        };

        document.getElementById('btnVenter').onclick = () => {
            selectionScreen.classList.add('hidden');
            formScreen.style.display = 'block';
        };

        document.getElementById('btnBackForm').onclick = () => {
            formScreen.style.display = 'none';
            selectionScreen.classList.remove('hidden');
        };

        document.getElementById('btnBackAdmin').onclick = () => {
            adminScreen.style.display = 'none';
            selectionScreen.classList.remove('hidden');
        };

        document.getElementById('btnSend').onclick = () => {
            const text = formInput.value.trim();
            const name = formName.value.trim() || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô";

            if (text === "") return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏ô‡∏∞");

            push(messagesRef, {
                nickname: name,
                text: text,
                date: new Date().toLocaleString('th-TH')
            })
            .then(() => {
                encouragementText.innerHTML = getRandomQuote();
                successModal.style.display = 'flex';
                setTimeout(() => { successModal.classList.add('show'); }, 10);
                setTimeout(() => { closeSuccessModal(); }, 3500);
            })
            .catch((error) => {
                alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + error.message);
            });
        };

        // Render Admin List
        onValue(messagesRef, (snapshot) => {
            messageList.innerHTML = "";
            const data = snapshot.val();
            
            if (data) {
                const list = Object.entries(data).reverse(); 
                list.forEach(([key, value]) => {
                    const li = document.createElement('li');
                    li.className = 'message-item';
                    const showName = value.nickname ? value.nickname : "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ï‡∏ô";

                    li.innerHTML = `
                        <div class="msg-content">
                            <div class="msg-name">‡∏Ñ‡∏∏‡∏ì ${showName}</div>
                            <div class="msg-text">${value.text}</div>
                            <div class="msg-date">${value.date}</div>
                        </div>
                        <div class="btn-group">
                            <button class="edit-btn" data-key="${key}" data-oldname="${showName}">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠</button>
                            <button class="delete-btn" data-key="${key}">‡∏•‡∏ö</button>
                        </div>
                    `;
                    messageList.appendChild(li);
                });

                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.onclick = function() {
                        if(confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡∏µ‡πâ?")) remove(ref(db, 'messages/' + this.dataset.key));
                    }
                });

                document.querySelectorAll('.edit-btn').forEach(btn => {
                    btn.onclick = function() {
                        const key = this.dataset.key;
                        const newName = prompt("‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡πà‡∏á:", this.dataset.oldname);
                        if (newName && newName.trim() !== "") {
                            update(ref(db, 'messages/' + key), { nickname: newName });
                        }
                    }
                });
            } else {
                messageList.innerHTML = "<p style='text-align:center; color:#999;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤</p>";
            }
        });
    </script>
</body>
</html>
